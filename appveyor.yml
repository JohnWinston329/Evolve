version: 1.0.0.{build}
skip_non_tags: false
image: Visual Studio 2017
configuration: Release
services:
- postgresql
- mssql2016
- mysql
init:
- cmd: SET PGUSER=postgres
- cmd: SET PGPASSWORD=Password12!
- cmd: SET MYSQL_PWD=Password12!
- cmd: SET PATH=C:\Program Files\PostgreSQL\9.5\bin\;%PATH%
- cmd: SET PATH=C:\Program Files\MySQL\MySQL Server 5.7\bin\;%PATH%
- cmd: SET PATH=C:\projects\evolve\packages\xunit.runner.console.2.3.0\tools\net452\;%PATH%
before_build:
- ps: dotnet restore
- ps: nuget restore
build:
  verbosity: minimal
before_test:
- cmd: createdb my_database
- cmd: mysql -e "create database my_database;" --user=root
test_script:
- ps: cd test/Evolve.Core.Test/
- ps: dotnet test
- ps: cd ../..

- ps: cd test/Evolve.Core.Test.Driver/
- ps: dotnet test
- ps: cd ../..

- cmd: xunit.console.exe test\Evolve.Test\bin\%CONFIGURATION%\Evolve.Test.dll
- cmd: xunit.console.exe test\Evolve.IntegrationTest.MySQL\bin\%CONFIGURATION%\Evolve.IntegrationTest.MySQL.dll
- cmd: xunit.console.exe test\Evolve.IntegrationTest.PostgreSQL\bin\%CONFIGURATION%\Evolve.IntegrationTest.PostgreSQL.dll
- cmd: xunit.console.exe test\Evolve.IntegrationTest.SQLServer\bin\%CONFIGURATION%\Evolve.IntegrationTest.SQLServer.dll
- cmd: xunit.console.exe test\Evolve.IntegrationTest.SQLite\bin\%CONFIGURATION%\Evolve.IntegrationTest.SQLite.dll
after_test:
- ps: cd src/Evolve
- ps: nuget pack Evolve.nuspec
- ps: cd ../..
artifacts:
- path: '**\Evolve*.nupkg'
